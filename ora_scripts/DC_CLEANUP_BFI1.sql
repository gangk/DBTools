                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  CREATE OR REPLACE PACKAGE "BOOKER"."DC_CLEANUP" IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    $Date: 2010/05/07 22:59:56 $                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    $Revision: 1.44 $                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    $Source: /src/cvs/src/oracle/databases/dc/dc_cleanup.pkg,v $                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    $Name:  $                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -- $Id: dc_cleanup.pkg,v 1.44 2010/05/07 22:59:56 rau Exp $                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Run daily cleanup jobs.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  PROCEDURE run_daily;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Mark PICKED_BATCH_CONTAINERS (PBC) empty if the container has no BIN_ITEMS.                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Rule and SQL from dlb.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  PROCEDURE pbc_mark_empty;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old CASH_SORTER_CHUTES_HISTORY.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -- Save 15 days worth of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  PROCEDURE show_cash_sort_chut_hist_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE purge_cash_sorter_chutes_hist(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge empty CONTAINERS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -- No days saved requirement.  Must have no BIN_ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- , CONTAINER_MOVE_SEGMENTS, or PENDING_CONTAINER_MOVES.                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  -- Only CASE, FULL_CASE_ITEM, PALLET, and SHIPPING_PACKAGE container types.                                                                                                                                                                                                                                                                                                                                                                                                                                       
  PROCEDURE purge_containers(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  PROCEDURE show_container_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge empty PENDING_CONTAINER_MOVES.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  -- Save 15 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE purge_pending_container_moves(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                           
  PROCEDURE show_pending_cont_move_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge empty CONTAINER_MOVE_SEGMENTS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  -- Save 15 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE purge_container_move_segments(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                           
  PROCEDURE show_container_move_seg_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge DO/DOI/DS/DSI (DISTRIBUTOR_ORDERS, DISTRIBUTOR_ORDER_ITEMS,                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- DISTRIBUTOR_SHIPMENTS, DISTRIBUTOR_SHIPMENT_ITEMS).                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  -- Purge DO that are COMPLETE.  Save 120 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  -- Purge the related DOI/DS/DSI related to those DO.                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  PROCEDURE show_distributor_orders_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                           
  PROCEDURE purge_distributor_orders(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -- Purge old FC_ASIN_SALES                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -- Save 8 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  PROCEDURE show_fc_asin_sales_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE purge_fc_asin_sales(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                     
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old INDUCTION_SESSION_SCANS                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Save 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_ind_session_scan_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                             
  PROCEDURE purge_induction_session_scans(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old INDUCTION_SESSIONS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  -- Save 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_induction_sessions_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                           
  PROCEDURE purge_induction_sessions(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old LP (LP_RECEIVED_CONTAINERS, LP_RECEIVED_ITEMS)                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  -- Save 90 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_license_plate_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE purge_license_plate(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old PICK_BATCH_SHIP_ROLLOVER_HIST                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -- Save 15 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_pbs_roll_hist_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE purge_pbs_rollover_hist(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old PICKED_SHIPMENT_BATCH_HISTORY                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -- Save 7 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  PROCEDURE show_psb_hist_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  PROCEDURE purge_pick_ship_batch_hist(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Delete PICKED_SHIPMENT_BATCHES and its related PICKED_SHIPMENT_ITEMS,                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -- PICKED_BATCH_CONTAINERS, PICK_BATCH_SHIPMENT_ROLLOVERS,                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -- and PICK_BATCH_SHIP_ROLLOVER_ITEMS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  -- Save 14 days of data.  Must have no PENDING_CUSTOMER_SHIPMENTS.                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE purge_picked_shipments(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  PROCEDURE show_picked_shipment_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old PICKLISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  -- Save 15 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_picklists_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  PROCEDURE purge_picklists(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                         
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -- Purge old PICK_WAVES                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  -- Save 15 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_pick_waves_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  PROCEDURE purge_pick_waves(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                        
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -- Purge old PROBLEM_SHIPMENTS and PROBLEM_SHIPMENT_ITEMS.                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -- Save 30 days of data.  Must have no PENDING_CUSTOMER_SHIPMENTS.                                                                                                                                                                                                                                                                                                                                                                                                                                                
--  PROCEDURE show_problem_shipment_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                           
--  PROCEDURE purge_problem_shipments(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                               
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old RECEIVE_PROBLEM_ITEMS_HISTORY                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -- Save 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_rec_prob_item_hist_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                           
  PROCEDURE purge_rec_prob_item_hist(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old RECEIVE_SESSION_SCANS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -- Save 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_rec_session_scan_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                             
  PROCEDURE purge_receive_session_scans(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old RECEIVE_SESSIONS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  -- Save 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_receive_sessions_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                             
  PROCEDURE purge_receive_sessions(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -- Purge old WHSE_DEMANDS, WHSE_DEMAND_ITEMS, PICK_DEMANDS,                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  -- CHUTE_DEMANDS, WHSE_DEMAND_PROCESS_CAT_MAP, and WHSE_DEMAND_EVENTS                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Save 60 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_whse_demands_count(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  PROCEDURE purge_whse_demands(p_days_saved NUMBER DEFAULT 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
-- *****                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
-- The following tables are purged through other jobs/processes:                                                                                                                                                                                                                                                                                                                                                                                                                                                    
-- COMPLETED_CUSTOMER_SHIPMENTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
-- CUSTOMER_SHIPMENT_ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
-- ORDER_PIPELINE_EVENTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
-- ******                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
-- The following tables cannot be purged.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
--                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
-- Archiveable Tables (save time period):                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
-- ICD_ADJUSTMENTS (6 quarters)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
-- INVENTORY_COUNT_DETAILS (6 quarters)                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
-- INVENTORY_COUNT_LOG (6 quarters)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
-- RECEIVE_PROBLEM_SHIPMENTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
-- RECEIVE_PROBLEM_ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
--                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
-- WIP Tables:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
-- BIN_ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
-- CUSTOMER_ORDER_WAREHOUSE_ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
-- DC_CUSTOMER_ORDERS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
-- PENDING_CUSTOMER_SHIPMENTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
-- PENDING_SHIPMENT_ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
-- PENDING_CUST_SHIPMENT_PKGS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
END dc_cleanup;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE OR REPLACE PACKAGE BODY "BOOKER"."DC_CLEANUP" IS                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    $Date: 2010/05/07 22:59:56 $                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    $Revision: 1.44 $                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    $Source: /src/cvs/src/oracle/databases/dc/dc_cleanup.pkg,v $                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    $Name:  $                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    Revision Control                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      V1.39                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      Create remote synonyms for distributor_shipments and distributor_shipment_                                                                                                                                                                                                                                                                                                                                                                                                                                    
items. For example:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      create or replace public synonym distributor_shipments_po for booker.distr                                                                                                                                                                                                                                                                                                                                                                                                                                    
ibutor_shipments@po1eu.amazon ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      create or replace public synonym distributor_shipment_items_po for booker.                                                                                                                                                                                                                                                                                                                                                                                                                                    
distributor_shipment_items@po1eu.amazon ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      The following table shows the PO link for each DC:                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       DCCDG2  PO1EU.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCCWL1  PO1EU.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCEDI2  PO1EU.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCFRA1  PO1EU.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCFRA3  PO1EU.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCGLA1  PO1EU.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCLEJ1  PO1EU.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCLTN1  PO1EU.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCORY1  PO1EU.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCNRT1  PO1FE.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCNRT2  PO1FE.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCABE1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCAVP1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCCVG1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCCVG2  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCCVG3  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCDFW1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCIND1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCIND2  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCLAS2  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCLEX1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCLEX2  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCPHL1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCPHL2  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCPHL4  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCPHL5  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCPHX3  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCPHX4  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCRNO1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCRNO2  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCSDF1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCSDF2  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCSEA6  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCTUL1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCVFC1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCVFC2  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       DCVRC1  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       FCL1NA  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       FCL2NA  PO1NA.AMAZON                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       Disable purge_picked_shipments procedure. See Contact Us 988                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      V1.40                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      Apply new logic for picked_shipment_batches candidate selection in purge_p                                                                                                                                                                                                                                                                                                                                                                                                                                    
icked_shipments.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -- Exceptions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  x_child_record_found EXCEPTION;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  PRAGMA EXCEPTION_INIT(x_child_record_found, -2292);                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  -- Output for SQL*Plus to display.  Gets around the                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  -- 255 character line limit in DBMS_OUTPUT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  PROCEDURE output(p_text VARCHAR2) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    v_text VARCHAR2(32000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_text := p_text;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    WHILE LENGTH(v_text) > 0 LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      DBMS_OUTPUT.PUT_LINE(SUBSTR(v_text, 1, 79));                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      v_text := SUBSTR(v_text, 80);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  END output;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  FUNCTION incremental_commit(p_count INTEGER DEFAULT 0) RETURN INTEGER IS                                                                                                                                                                                                                                                                                                                                                                                                                                          
    -- Assume large commit interval b/c no snapshots                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    const_commit_interval     CONSTANT INTEGER := 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    --const_sleep_interval_secs CONSTANT INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- Increment the current count by 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_count := NVL(p_count, 0) + 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Commit if the commit interval is reached.                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Sleep for a period of time to allow the archive logs                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- to catch up.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    IF MOD(v_count, const_commit_interval) = 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
     -- DBMS_LOCK.SLEEP(const_sleep_interval_secs);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- Return the new count.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    RETURN v_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  END incremental_commit;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE log_error(p_procedure_name VARCHAR2) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    PRAGMA AUTONOMOUS_TRANSACTION;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    v_instance varchar2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    err_msg    varchar2(4000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    --  admin.message_utilities.log_error( 'dc_cleanup.' ||                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    --        p_procedure_name , 'DC_CLEANUP'                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    --      , SQLCODE || ' ' || SQLERRM                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    --      , SYSDATE, 'MONTH' );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    err_msg := SQLERRM;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    SELECT UPPER(instance_name) INTO v_instance FROM v$instance;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    INSERT INTO FC_PURGE_NOTIFICATIONS                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      (instance,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
       note_date,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
       note_category,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       note_type,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
       note_lifetime,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       note_source,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       NOTE_SUBJECT,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       note)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    VALUES                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      (v_instance,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       sysdate,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       'ERROR',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       'DC_CLEANUP.LOG_ERROR',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
       'MONTH',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       'dc_cleanup.' || p_procedure_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       'dc_cleanup.' || p_procedure_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       err_msg);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    output(p_procedure_name || ':  ' || SQLERRM);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    commit;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  END log_error;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE display_count_message(p_table_name   VARCHAR2,                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                  p_record_count number) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    PRAGMA AUTONOMOUS_TRANSACTION;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    v_instance varchar2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- Display message of purgeable records                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    SELECT UPPER(instance_name) INTO v_instance FROM v$instance;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    INSERT INTO FC_PURGE_NOTIFICATIONS                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      (instance,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
       note_date,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
       note_category,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       note_source,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       note_lifetime,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       note_subject,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       note,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
       table_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       num_rows)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    VALUES                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      (v_instance,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       sysdate,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       'LOG',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       'DC_CLEANUP.DISPLAY_COUNT',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       'DAY',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       p_table_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       UPPER(p_table_name) || ':  ' || p_record_count ||                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       ' purgeable records.',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       p_table_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       p_record_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    commit;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    output(UPPER(p_table_name) || ':  ' || p_record_count ||                                                                                                                                                                                                                                                                                                                                                                                                                                                        
           ' purgeable records.');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  END display_count_message;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE display_purge_message(p_table_name      VARCHAR2,                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                  p_records_deleted number) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    v_instance varchar2(30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    SELECT UPPER(instance_name) INTO v_instance FROM v$instance;                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    INSERT INTO FC_PURGE_NOTIFICATIONS                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      (instance,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
       note_date,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
       note_category,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       note_source,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       note_lifetime,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       note_subject,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       note,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
       table_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       num_rows)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    VALUES                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      (v_instance,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       sysdate,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       'LOG',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       'DC_CLEANUP.PURGED',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
       'DAY',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       p_table_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       'Purged ' || UPPER(p_table_name) || ':  ' || p_records_deleted ||                                                                                                                                                                                                                                                                                                                                                                                                                                            
       ' records.',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       p_table_name,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       p_records_deleted);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    commit;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- Display message of records deleted.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    output('Purged ' || UPPER(p_table_name) || ':  ' || p_records_deleted ||                                                                                                                                                                                                                                                                                                                                                                                                                                        
           ' records.');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  END display_purge_message;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Return the greatest number of days when comparing                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- what was passed in versus the minimum for each table.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -- ++ BE SURE TO UPDATE THE HEADER COMMENTS ++                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  FUNCTION get_min_saved_date(p_table_name VARCHAR2, p_days_saved NUMBER)                                                                                                                                                                                                                                                                                                                                                                                                                                           
    RETURN DATE IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    v_days_saved NUMBER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    v_min_date   DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    IF p_table_name = 'CASH_SORTER_CHUTES_HISTORY' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      v_days_saved := GREATEST(p_days_saved, 15);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'CONTAINERS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_days_saved := GREATEST(p_days_saved, 0);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    ELSIF p_table_name = 'PENDING_CONTAINER_MOVES' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      v_days_saved := GREATEST(p_days_saved, 15);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'CONTAINER_MOVE_SEGMENTS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      v_days_saved := GREATEST(p_days_saved, 30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'DC_DISTRIBUTOR_ORDERS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      v_days_saved := GREATEST(p_days_saved, 120);                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    /* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      ELSIF p_table_name = 'FC_ASIN_SALES' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      v_days_saved := GREATEST(p_days_saved, 8);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    ELSIF p_table_name = 'INDUCTION_SESSION_SCANS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      v_days_saved := GREATEST(p_days_saved, 30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'INDUCTION_SESSIONS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      v_days_saved := GREATEST(p_days_saved, 30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'LP_RECEIVED_CONTAINERS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      v_days_saved := GREATEST(p_days_saved, 90);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'LP_RECEIVED_ITEMS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      v_days_saved := GREATEST(p_days_saved, 90);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'PICK_BATCH_SHIP_ROLLOVER_HIST' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      v_days_saved := GREATEST(p_days_saved, 15);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    ELSIF p_table_name = 'PICK_WAVES' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_days_saved := GREATEST(p_days_saved, 15);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    ELSIF p_table_name = 'PICKED_SHIPMENT_BATCH_HISTORY' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      v_days_saved := GREATEST(p_days_saved, 7);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    ELSIF p_table_name = 'PICKED_SHIPMENT_BATCHES' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      v_days_saved := GREATEST(p_days_saved, 14);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    ELSIF p_table_name = 'PICKLISTS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      v_days_saved := GREATEST(p_days_saved, 15);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    ELSIF p_table_name = 'PROBLEM_SHIPMENTS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      v_days_saved := GREATEST(p_days_saved, 30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    ELSIF p_table_name = 'RECEIVE_PROBLEM_ITEMS_HISTORY' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      v_days_saved := GREATEST(p_days_saved, 30);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'RECEIVE_SESSION_SCANS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      v_days_saved := GREATEST(p_days_saved, 35);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'RECEIVE_SESSIONS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      v_days_saved := GREATEST(p_days_saved, 35);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    ELSIF p_table_name = 'WHSE_DEMANDS' THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      v_days_saved := GREATEST(p_days_saved, 60);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_min_date := TRUNC(SYSDATE) - v_days_saved;                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    output(p_table_name || ' days saved: ' || v_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    output('Min Saved Date: ' ||                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
           TO_CHAR(v_min_date, 'DD-MON-YYYY HH24:MI'));                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    RETURN v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  END get_min_saved_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  -- Mark PICKED_BATCH_CONTAINERS empty if the container has no BIN_ITEMS.                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -- Rule and SQL from dlb.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  PROCEDURE pbc_mark_empty IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- Set the EMPTY_IND to 'Y' for all PICKED_BATCH_CONTAINERS                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    -- whose container has no BIN_ITEMS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    UPDATE picked_batch_containers pbc                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
       SET empty_ind = 'Y'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
     WHERE empty_ind = 'N'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
       AND creation_date < SYSDATE - 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
       AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
     (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
              FROM bin_items bi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             WHERE bi.container_id = pbc.container_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    output('PICKED_BATCH_CONTAINERS marked empty - ' || SQL%ROWCOUNT);                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- Commit changes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('pbc_mark_empty');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      output('PICKED_BATCH_CONTAINERS marked empty - ' || SQL%ROWCOUNT);                                                                                                                                                                                                                                                                                                                                                                                                                                            
  END pbc_mark_empty;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -- Get count of CASH_SORTER_CHUTES_HISTORY that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  PROCEDURE show_cash_sort_chut_hist_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                        
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('CASH_SORTER_CHUTES_HISTORY',                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                     p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Get count of CASH_SORTER_CHUTES_HISTORY to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM cash_sorter_chutes_history                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
     WHERE last_updated_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    display_count_message('CASH_SORTER_CHUTES_HISTORY', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  END show_cash_sort_chut_hist_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old CASH_SORTER_CHUTES_HISTORY.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE purge_cash_sorter_chutes_hist(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_cash_sorter_chutes_history(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM cash_sorter_chutes_history                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       WHERE last_updated_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_cash_sort_chut_hist_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- Loop through CASH_SORTER_CHUTES_HISTORY to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    -- (1) Save most recent 15 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_csch IN c_cash_sorter_chutes_history(get_min_saved_date('CASH_SORTE                                                                                                                                                                                                                                                                                                                                                                                                                                    
R_CHUTES_HISTORY',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                     p_days_save                                                                                                                                                                                                                                                                                                                                                                                                                                    
d)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM cash_sorter_chutes_history WHERE rowid = crec_csch.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                         
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('CASH_SORTER_CHUTES_HISTORY', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_cash_sorter_chutes_hist');                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      display_purge_message('CASH_SORTER_CHUTES_HISTORY', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  END purge_cash_sorter_chutes_hist;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of PENDING_CONTAINER_MOVES to be purged.                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  PROCEDURE show_pending_cont_move_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                          
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('PENDING_CONTAINER_MOVES',                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                     p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Get count of PENDING_CONTAINER_MOVES to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM pending_container_moves pcm                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
     WHERE request_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    display_count_message('PENDING_CONTAINER_MOVES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  END show_pending_cont_move_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Purge old PENDING_CONTAINER_MOVES                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  PROCEDURE purge_pending_container_moves(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_pending_container_moves(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      SELECT pcm.rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        FROM pending_container_moves pcm                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       WHERE pcm.request_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_pending_cont_move_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    -- Get the PENDING_CONTAINER_MOVES to delete.  Rules for deletion by DLB.                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- (1) 15 days of saved data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    FOR crec_pending_container_move IN c_pending_container_moves(get_min_saved_d                                                                                                                                                                                                                                                                                                                                                                                                                                    
ate('PENDING_CONTAINER_MOVES',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    p_days_saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      -- Delete items from pending_container_moves                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      DELETE FROM pending_container_moves pcm                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       WHERE rowid = crec_pending_container_move.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('PENDING_CONTAINER_MOVES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_pending_container_moves');                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      display_purge_message('PENDING_CONTAINER_MOVES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  END purge_pending_container_moves;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of CONTAINER_MOVE_SEGMENTS to be purged.                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  PROCEDURE show_container_move_seg_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('CONTAINER_MOVE_SEGMENTS',                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                     p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Get count of CONTAINER_MOVE_SEGMENTS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM container_move_segments cms                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
     WHERE move_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    display_count_message('CONTAINER_MOVE_SEGMENTS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  END show_container_move_seg_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Purge old CONTAINER_MOVE_SEGMENTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  PROCEDURE purge_container_move_segments(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_container_move_segments(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      SELECT cms.rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        FROM container_move_segments cms                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       WHERE cms.move_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_container_move_seg_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Get the CONTAINER_MOVE_SEGMENTS to delete.  Rules for deletion by DLB.                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- (1) 15 days of saved data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    FOR crec_container_move_segment IN c_container_move_segments(get_min_saved_d                                                                                                                                                                                                                                                                                                                                                                                                                                    
ate('CONTAINER_MOVE_SEGMENTS',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    p_days_saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      -- Delete the container                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      DELETE FROM container_move_segments                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       WHERE rowid = crec_container_move_segment.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('CONTAINER_MOVE_SEGMENTS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_container_move_segments');                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      display_purge_message('CONTAINER_MOVE_SEGMENTS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  END purge_container_move_segments;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of CONTAINERS to be purged.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_container_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('CONTAINERS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- Get count of CONTAINERS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM containers_physical c1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
     WHERE container_type IN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
           ('CASE', 'FULL_CASE_ITEM', 'PALLET', 'SHIPPING_PACKAGE')                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       AND (last_updated < v_min_date OR last_updated IS NULL)                                                                                                                                                                                                                                                                                                                                                                                                                                                      
       AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
              FROM bin_items bi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
             WHERE bi.container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
     (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
              FROM containers_physical c2                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
             WHERE c2.containing_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                    
       AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
              FROM containers_physical c2                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
              WHERE c1.container_type = 'PALLET' and c2.container_type='SHIPPING                                                                                                                                                                                                                                                                                                                                                                                                                                    
_PROCESS_AREA'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
              and c2.container_id = c1.containing_container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
              FROM pending_container_moves pcm                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             WHERE pcm.container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                              
       AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
              FROM container_move_segments cms                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             WHERE cms.container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                              
       AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
              FROM pending_cust_shipment_pkgs pcsp                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
             WHERE pcsp.scannable_id = c1.scannable_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
     (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
              FROM cash_sorter_chutes csc                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
             WHERE csc.packing_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                      
       AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
     (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
              FROM container_sorter_dest_map csdm                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
             WHERE csdm.destination_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
              FROM picked_batch_containers pbc                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             WHERE pbc.container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                              
       AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
     (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
              FROM pick_batch_types pbt                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
             WHERE pbt.destination_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
     (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
              from reprofile_item_moves rim                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
             WHERE rim.move_from_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                    
       AND NOT EXISTS ( SELECT 1 from inbound_containers ic                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                          WHERE ic.scannable_id = c1.scannable_id AND                                                                                                                                                                                                                                                                                                                                                                                                                                               
                          ic.creation_date > sysdate - 4 );                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_count_message('CONTAINERS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  END show_container_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge empty CONTAINERS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  PROCEDURE purge_containers(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_containers(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      SELECT c1.rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        FROM containers_physical c1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       WHERE container_type IN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             ('CASE', 'FULL_CASE_ITEM', 'PALLET', 'SHIPPING_PACKAGE')                                                                                                                                                                                                                                                                                                                                                                                                                                               
         AND (last_updated < cp_min_date OR last_updated IS NULL)                                                                                                                                                                                                                                                                                                                                                                                                                                                   
         AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                FROM bin_items bi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
               WHERE bi.container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                             
         AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                FROM containers_physical c2                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
               WHERE c2.containing_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                  
         AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
              FROM containers_physical c2                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
              WHERE c1.container_type = 'PALLET' and c2.container_type='SHIPPING                                                                                                                                                                                                                                                                                                                                                                                                                                    
_PROCESS_AREA'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
              and c2.container_id = c1.containing_container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                     
         AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                FROM pending_container_moves pcm                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
               WHERE pcm.container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                            
         AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                FROM container_move_segments cms                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
               WHERE cms.container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                            
         AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                FROM pending_cust_shipment_pkgs pcsp                                                                                                                                                                                                                                                                                                                                                                                                                                                                
               WHERE pcsp.scannable_id = c1.scannable_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                           
         AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                FROM cash_sorter_chutes csc                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
               WHERE csc.packing_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                    
         AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                FROM container_sorter_dest_map csdm                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
               WHERE csdm.destination_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                               
         AND NOT EXISTS (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                FROM picked_batch_containers pbc                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
               WHERE pbc.container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                            
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                FROM pick_batch_types pbt                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
               WHERE pbt.destination_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
         AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                from reprofile_item_moves rim                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
               WHERE rim.move_from_container_id = c1.container_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                  
         AND NOT EXISTS ( SELECT 1 from inbound_containers ic                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                          WHERE ic.scannable_id = c1.scannable_id AND                                                                                                                                                                                                                                                                                                                                                                                                                                               
                          ic.creation_date > sysdate - 4 );                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- show_container_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    -- Purge old CONTAINER_MOVE_SEGMENTS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    purge_container_move_segments(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Purge old PENDING_CONTAINER_MOVES.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    purge_pending_container_moves(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Get the containers to delete.  Rules for deletion by DLB@.                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- (1) Only CONTAINER_TYPEs: CASE, FULL_CASE_ITEM, PALLET, SHIPPING_PACKAGE                                                                                                                                                                                                                                                                                                                                                                                                                                     
    -- (2) No related BIN_ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    -- (3) No related CONTAINERS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- (4) No related PENDING_CONTAINER_MOVES                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- (5) No related CONTAINER_MOVE_SEGMENTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- No days of data saved restriction.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    FOR crec_container IN c_containers(get_min_saved_date('CONTAINERS',                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                          p_days_saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                       
      -- Put into own block to handle situation when child records                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      -- exist.  This will allow purging to continue.                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        -- Delete the container                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        DELETE FROM containers_physical WHERE rowid = crec_container.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                         
        -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        WHEN x_child_record_found THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
          output('Child Record Found - CONTAINER ROWID: ' ||                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                 crec_container.rowid || '  ' || SQLERRM);                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('CONTAINERS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_containers');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      display_purge_message('CONTAINERS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  END purge_containers;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of DC_DISTRIBUTOR_ORDERS that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_distributor_orders_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('DC_DISTRIBUTOR_ORDERS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                        
    -- Get count of DC_DISTRIBUTOR_ORDERS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM (SELECT order_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
              FROM dc_distributor_orders                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
             WHERE condition = 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
               AND last_updated < v_min_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
            MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
            SELECT distributor_order_id FROM bin_items);                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    display_count_message('DC_DISTRIBUTOR_ORDERS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  END show_distributor_orders_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  --  Purge completed DISTRIBUTOR_ORDERS that are more than 120 days old                                                                                                                                                                                                                                                                                                                                                                                                                                            
  --  and its related DISTRIBUTOR_ORDER_ITEMS, DISTRIBUTOR_SHIPMENTS,                                                                                                                                                                                                                                                                                                                                                                                                                                               
  --  and DISTRIBUTOR_SHIPMENT_ITEMS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  PROCEDURE purge_distributor_orders(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                              
    v_count      INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    v_delete_all BOOLEAN := TRUE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    const_do_commit_interval     CONSTANT INTEGER := 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    const_do_sleep_interval_secs CONSTANT INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    CURSOR c_do(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      SELECT order_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        FROM dc_distributor_orders                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       WHERE condition = 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         AND last_updated < cp_min_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      SELECT distributor_order_id FROM bin_items;                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    CURSOR c_ds(cp_order_id VARCHAR2) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      SELECT shipment_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        FROM dc_distributor_shipments                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       WHERE order_id = cp_order_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      SELECT shipment_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        FROM distributor_shipments_po                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       WHERE order_id = cp_order_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_dsi(cp_order_id VARCHAR2) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      SELECT distributor_shipment_item_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        FROM dc_distributor_shipment_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
       WHERE order_id = cp_order_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      SELECT distributor_shipment_item_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        FROM distributor_shipment_items_po                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
       WHERE order_id = cp_order_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- NOTE: Going against the "DC_" tables b/c the non-DC DO/DOI                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- tables have views that are read-only over them.                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- Open cursor of completed DISTRIBUTOR_ORDERS that is older than 120 days.                                                                                                                                                                                                                                                                                                                                                                                                                                     
    FOR crec_do IN c_do(get_min_saved_date('DC_DISTRIBUTOR_ORDERS',                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                           p_days_saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      -- Check to make sure the number of DS and DSI records between the DC and                                                                                                                                                                                                                                                                                                                                                                                                                                     
PO                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      -- databases are the same.  If not, will need to update in order to replic                                                                                                                                                                                                                                                                                                                                                                                                                                    
ate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      -- rows to PO database.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      -- Update DS records not present in PO database.                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      FOR crec_ds IN c_ds(crec_do.order_id) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        UPDATE dc_distributor_shipments                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
           SET warehouse_id = warehouse_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         WHERE order_id = crec_do.order_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
           AND shipment_id = crec_ds.shipment_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        v_delete_all := FALSE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
        commit;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Update DSI records not present in PO database.                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      FOR crec_dsi IN c_dsi(crec_do.order_id) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        UPDATE dc_distributor_shipment_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
           SET isbn = isbn                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
         WHERE distributor_shipment_item_id =                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
               crec_dsi.distributor_shipment_item_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        v_delete_all := FALSE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
        commit;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      IF (v_delete_all) THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
        -- Delete DC_DISTRIBUTOR_SHIPMENT_ITEMS for a DO                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        DELETE FROM dc_distributor_shipment_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
         WHERE order_id = crec_do.order_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        -- Delete DC_DISTRIBUTOR_SHIPMENTS for a DO                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
        DELETE FROM dc_distributor_shipments                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
         WHERE order_id = crec_do.order_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        -- Delete DC_DISTRIBUTOR_ORDER_ITEMS for a DO                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        DELETE FROM dc_distributor_order_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
         WHERE order_id = crec_do.order_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        -- Delete the DC_DISTRIBUTOR_ORDER.                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        DELETE FROM dc_distributor_orders                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
         WHERE order_id = crec_do.order_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        -- Increment the counter.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        v_count := NVL(v_count, 0) + 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
        commit;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      -- Since there are multiple records per DO record, we will commit more oft                                                                                                                                                                                                                                                                                                                                                                                                                                    
en                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      IF MOD(v_count, const_do_commit_interval) = 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        DBMS_LOCK.SLEEP(const_do_sleep_interval_secs);                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      v_delete_all := TRUE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('DC_DISTRIBUTOR_ORDERS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_distributor_orders');                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  END purge_distributor_orders;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
/* deprecated unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  -- Get count of FC_ASIN_SALES that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  PROCEDURE show_fc_asin_sales_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                              
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('FC_ASIN_SALES', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                
    -- Get count of FC_ASIN_SALES to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM fc_asin_sales                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
     WHERE last_updated_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    display_count_message('FC_ASIN_SALES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  END show_fc_asin_sales_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old FC_ASIN_SALES.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  PROCEDURE purge_fc_asin_sales(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_fc_asin_sales(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM fc_asin_sales                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
       WHERE last_updated_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_fc_asin_sales_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- Loop through FC_ASIN_SALES to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- (1) Save most recent 8 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    FOR crec_fc_asin_sales IN c_fc_asin_sales(get_min_saved_date('FC_ASIN_SALES'                                                                                                                                                                                                                                                                                                                                                                                                                                    
,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                 p_days_saved))                                                                                                                                                                                                                                                                                                                                                                                                                                     
LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM fc_asin_sales WHERE rowid = crec_fc_asin_sales.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                             
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('FC_ASIN_SALES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_fc_asin_sales');                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      display_purge_message('FC_ASIN_SALES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  END purge_fc_asin_sales;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of INDUCTION_SESSION_SCANS that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  PROCEDURE show_ind_session_scan_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                           
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('INDUCTION_SESSION_SCANS',                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                     p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Get count of INDUCTION_SESSION_SCANS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM induction_session_scans                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
     WHERE induction_time < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    display_count_message('INDUCTION_SESSION_SCANS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  END show_ind_session_scan_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old INDUCTION_SESSIOIN_SCANS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  PROCEDURE purge_induction_session_scans(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_induction_session_scans(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM induction_session_scans                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       WHERE induction_time < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_ind_session_scan_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    -- Loop through INDUCTION_SESSION_SCANS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    -- (1) Save most recent 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_scan IN c_induction_session_scans(get_min_saved_date('INDUCTION_SES                                                                                                                                                                                                                                                                                                                                                                                                                                    
SION_SCANS',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                  p_days_saved))                                                                                                                                                                                                                                                                                                                                                                                                                                    
 LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM induction_session_scans WHERE rowid = crec_scan.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                            
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('INDUCTION_SESSION_SCANS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_induction_session_scans');                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      display_purge_message('INDUCTION_SESSION_SCANS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  END purge_induction_session_scans;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of INDUCTION_SESSIONS that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  PROCEDURE show_induction_sessions_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('INDUCTION_SESSIONS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                           
    -- Get count of INDUCTION_SESSIONS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM induction_sessions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
     WHERE start_time < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    display_count_message('INDUCTION_SESSIONS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  END show_induction_sessions_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old INDUCTION_SESSIONS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  PROCEDURE purge_induction_sessions(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                              
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_induction_sessions(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      SELECT rowid FROM induction_sessions WHERE start_time < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                          
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_induction_sessions_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Loop through INDUCTION_SESSIONS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- (1) Save most recent 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_rec_sess IN c_induction_sessions(get_min_saved_date('INDUCTION_SESS                                                                                                                                                                                                                                                                                                                                                                                                                                    
IONS',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                 p_days_saved))                                                                                                                                                                                                                                                                                                                                                                                                                                     
LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM induction_sessions WHERE rowid = crec_rec_sess.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                             
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('INDUCTION_SESSIONS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_induction_sessions');                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      display_purge_message('INDUCTION_SESSIONS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  END purge_induction_sessions;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of LP tables that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  PROCEDURE show_license_plate_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                              
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('LP_RECEIVED_ITEMS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                            
    -- Get count of LP_RECEIVED_ITEMS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM lp_received_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
     WHERE creation_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    display_count_message('LP_RECEIVED_ITEMS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    v_min_date := get_min_saved_date('LP_RECEIVED_CONTAINERS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Get count of LP_RECEIVED_CONTAINERS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM lp_received_containers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
     WHERE creation_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    display_count_message('LP_RECEIVED_CONTAINERS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  END show_license_plate_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old LP TABLES.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  PROCEDURE purge_license_plate(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_lp_received_items(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM lp_received_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
       WHERE creation_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    CURSOR c_lp_received_containers(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM lp_received_containers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       WHERE creation_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_license_plate_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- Loop through LP_RECEIVED_ITEMS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    -- (1) Save most recent 90 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_lp_received_items IN c_lp_received_items(get_min_saved_date('LP_REC                                                                                                                                                                                                                                                                                                                                                                                                                                    
EIVED_ITEMS',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                         p_days_                                                                                                                                                                                                                                                                                                                                                                                                                                    
saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM lp_received_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       WHERE rowid = crec_lp_received_items.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('LP_RECEIVED_ITEMS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    v_count := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- Loop through LP_RECEIVED_CONTAINERS                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    -- (1) Save most recent 90 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_lp_received_containers IN c_lp_received_containers(get_min_saved_da                                                                                                                                                                                                                                                                                                                                                                                                                                    
te('LP_RECEIVED_CONTAINERS',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
   p_days_saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM lp_received_containers                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       WHERE rowid = crec_lp_received_containers.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('LP_RECEIVED_CONTAINERS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_license_plate');                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      display_purge_message('LP TABLE', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  END purge_license_plate;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of PICK_BATCH_SHIP_ROLLOVER_HIST that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  PROCEDURE show_pbs_roll_hist_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                              
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('PICK_BATCH_SHIP_ROLLOVER_HIST',                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                     p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Get count of PICK_BATCH_SHIP_ROLLOVER_HIST to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM pick_batch_ship_rollover_hist                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
     WHERE last_updated_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    display_count_message('PICK_BATCH_SHIP_ROLLOVER_HIST', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  END show_pbs_roll_hist_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old PICK_BATCH_SHIP_ROLLOVER_HIST.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  PROCEDURE purge_pbs_rollover_hist(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                               
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_pbs_rollover_hist(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM pick_batch_ship_rollover_hist                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
       WHERE last_updated_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_pbs_roll_hist_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- Loop through PICK_BATCH_SHIP_ROLLOVER_HIST to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- (1) Save most recent 15 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_pbsrh IN c_pbs_rollover_hist(get_min_saved_date('PICK_BATCH_SHIP_RO                                                                                                                                                                                                                                                                                                                                                                                                                                    
LLOVER_HIST',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                             p_days_saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM pick_batch_ship_rollover_hist                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       WHERE rowid = crec_pbsrh.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('PICK_BATCH_SHIP_ROLLOVER_HIST', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_pbs_rollover_hist');                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      display_purge_message('PICK_BATCH_SHIP_ROLLOVER_HIST', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                              
  END purge_pbs_rollover_hist;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of PICKED_SHIPMENT_BATCH_HISTORY that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  PROCEDURE show_psb_hist_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('PICKED_SHIPMENT_BATCH_HISTORY',                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                     p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Get count of PICKED_SHIPMENT_BATCH_HISTORY to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM picked_shipment_batch_history                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
     WHERE last_updated_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    display_count_message('PICKED_SHIPMENT_BATCH_HISTORY', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  END show_psb_hist_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old PICKED_SHIPMENT_BATCH_HISTORY.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  PROCEDURE purge_pick_ship_batch_hist(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                            
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_pick_ship_batch_hist(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM picked_shipment_batch_history                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
       WHERE last_updated_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_psb_hist_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    -- Loop through PICKED_SHIPMENT_BATCH_HISTORY to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- (1) Save most recent 7 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    FOR crec_pick_ship_batch_hist IN c_pick_ship_batch_hist(get_min_saved_date('                                                                                                                                                                                                                                                                                                                                                                                                                                    
PICKED_SHIPMENT_BATCH_HISTORY',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                               p                                                                                                                                                                                                                                                                                                                                                                                                                                    
_days_saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM picked_shipment_batch_history                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       WHERE rowid = crec_pick_ship_batch_hist.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('PICKED_SHIPMENT_BATCH_HISTORY', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_pick_ship_batch_hist');                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      display_purge_message('PICKED_SHIPMENT_BATCH_HISTORY', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                              
  END purge_pick_ship_batch_hist;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of PICKED_SHIPMENT_BATCHES to be purged.                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  PROCEDURE show_picked_shipment_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                            
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('PICKED_SHIPMENT_BATCHES',                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                     p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Get count of PICK_SHIPMENT_BATCHES to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM (SELECT pick_batch_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              FROM picked_shipment_batches psb                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
             WHERE creation_date < v_min_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
               AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
             (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                      FROM pick_requests pr                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                     WHERE pr.pick_batch_id = psb.pick_batch_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                    
            MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
            SELECT pick_batch_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
              FROM pending_customer_shipments                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
             WHERE pick_batch_id > 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
               AND pick_batch_id IS NOT NULL);                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    display_count_message('PICKED_SHIPMENT_BATCHES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  END show_picked_shipment_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  -- Delete PICKED_SHIPMENT_BATCHES and its related PICKED_SHIPMENT_ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                           
  -- and PICKED_BATCH_CONTAINERS that are not associated                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  -- w/ a PENDING_CUSTOMER_SHIPMENT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE purge_picked_shipments(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                
    v_batch_count         INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_container_count     INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_item_count          INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_rollover_count      INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_rollover_item_count INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- Get PICKED_SHIPMENT_BATCHES that are within a the specified                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    -- range but are not associated w/ a PENDING_CUSTOMER_SHIPMENT                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    -- or less than 14 days old.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    /*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      CURSOR c_picked_shipment_batches ( cp_min_date  DATE ) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        SELECT pick_batch_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
          FROM picked_shipment_batches psb                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
          WHERE creation_date < cp_min_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    AND NOT EXISTS ( SELECT 1 FROM pick_requests pr                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       WHERE pr.pick_batch_id = psb.pick_batch_id )                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
        MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
          SELECT pick_batch_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
           FROM pending_customer_shipments                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
           WHERE pick_batch_id > 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
             AND pick_batch_id IS NOT NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      */                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    CURSOR c_picked_shipment_batches(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      SELECT pick_batch_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        FROM picked_shipment_batches psb                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
       WHERE creation_date < cp_min_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
         AND NOT EXISTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       (SELECT 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                FROM pick_requests pr                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
               WHERE pr.pick_batch_id = psb.pick_batch_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      SELECT pick_batch_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        FROM pending_customer_shipments                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       WHERE pick_batch_id > 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
         AND pick_batch_id IS NOT NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      SELECT DISTINCT (psi.batch_id)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        FROM picked_shipment_items psi, whse_demands wd                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       WHERE psi.customer_shipment_id = wd.demand_consumer_id                                                                                                                                                                                                                                                                                                                                                                                                                                                       
         AND wd.demand_consumer_type_id = 9                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
         AND (wd.status <> 'COMPLETED' OR                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
             wd.last_updated_date > sysdate - 14);                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    -- Cursor to get PICKED_SHIPMENT_ITEMS for a PICK_BATCH_ID                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    CURSOR c_picked_shipment_items(cp_pick_batch_id NUMBER) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM picked_shipment_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       WHERE batch_id = cp_pick_batch_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_picked_shipment_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Loop through the old PICKED_SHIPMENT_BATCHES and purge its                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- PICKED_SHIPMENT_ITEMS and PICKED_BATCH_CONTAINERS.                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    FOR crec_psb IN c_picked_shipment_batches(get_min_saved_date('PICKED_SHIPMEN                                                                                                                                                                                                                                                                                                                                                                                                                                    
T_BATCHES',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                 p_days_saved))                                                                                                                                                                                                                                                                                                                                                                                                                                     
LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      -- Delete the PICKED_SHIPMENT_ITEMS for a batch.  There can be                                                                                                                                                                                                                                                                                                                                                                                                                                                
      -- up to 2000 PSI for a batch so need to commit in small amounts                                                                                                                                                                                                                                                                                                                                                                                                                                              
      -- in order not run out of rollback segments.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      FOR c_rec IN c_picked_shipment_items(crec_psb.pick_batch_id) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                             
        DELETE FROM picked_shipment_items WHERE rowid = c_rec.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                
        -- Incrementally commit.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        v_item_count := incremental_commit(v_item_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Delete the PICK_BATCH_ROLLOVER_ITEMS for a batch.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      -- Need to do this before its parent, PICK_BATCH_SHIPMENT_ROLLOVERS,                                                                                                                                                                                                                                                                                                                                                                                                                                          
      -- to avoid an FK violation.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      DELETE FROM pick_batch_ship_rollover_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
       WHERE pick_batch_id = crec_psb.pick_batch_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      v_rollover_item_count := v_rollover_item_count + SQL%ROWCOUNT;                                                                                                                                                                                                                                                                                                                                                                                                                                                
      -- Delete the PICK_BATCH_SHIPMENT_ROLLOVERS for a batch.                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      DELETE FROM pick_batch_shipment_rollovers                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       WHERE pick_batch_id = crec_psb.pick_batch_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      v_rollover_count := v_rollover_count + SQL%ROWCOUNT;                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      -- Delete the PICKED_BATCH_CONTAINERS for a batch.                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      DELETE FROM picked_batch_containers                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       WHERE batch_id = crec_psb.pick_batch_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      v_container_count := v_container_count + SQL%ROWCOUNT;                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      -- We commit here since the delete on PICKED_SHIPMENT_BATCH will not be                                                                                                                                                                                                                                                                                                                                                                                                                                       
      -- always be successful because of a second foreign key constraint                                                                                                                                                                                                                                                                                                                                                                                                                                            
      -- to PICK_BATCH_SHIPMENT_ROLLOVERS.ROUTING_BATCH_ID.                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      -- Delete the PICKED_SHIPMENT_BATCH                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      -- Putting into own block to avoid erroring out when new                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      -- child tables are added.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
      BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        DELETE FROM picked_shipment_batches                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
         WHERE pick_batch_id = crec_psb.pick_batch_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        v_batch_count := v_batch_count + 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        WHEN x_child_record_found THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
          output('Child Record Found - PICK_SHIPMENT_BATCHES: ' ||                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                 'PICK_BATCH_ID = ' || TO_CHAR(crec_psb.pick_batch_id) ||                                                                                                                                                                                                                                                                                                                                                                                                                                           
                 ' -- ' || SQLERRM);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
          ROLLBACK;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      -- Commit the change.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    display_purge_message('PICKED_SHIPMENT_BATCHES', v_batch_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                
    display_purge_message('PICKED_SHIPMENT_ITEMS', v_item_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    display_purge_message('PICKED_BATCH_CONTAINERS', v_container_count);                                                                                                                                                                                                                                                                                                                                                                                                                                            
    display_purge_message('PICK_BATCH_SHIPMENT_ROLLOVERS',                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                          v_rollover_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    display_purge_message('PICK_BATCH_SHIP_ROLLOVER_ITEMS',                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                          v_rollover_item_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_picked_shipments');                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      display_purge_message('PICKED_SHIPMENT_BATCHES', v_batch_count);                                                                                                                                                                                                                                                                                                                                                                                                                                              
      display_purge_message('PICKED_SHIPMENT_ITEMS', v_item_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      display_purge_message('PICKED_BATCH_CONTAINERS', v_container_count);                                                                                                                                                                                                                                                                                                                                                                                                                                          
      display_purge_message('PICK_BATCH_SHIPMENT_ROLLOVERS',                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                            v_rollover_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      display_purge_message('PICK_BATCH_SHIP_ROLLOVER_ITEMS',                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                            v_rollover_item_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  END purge_picked_shipments;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -- Get count of PICKLISTS that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  PROCEDURE show_picklists_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('PICKLISTS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Get count of PICKLISTS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM picklists                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
     WHERE creation_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    display_count_message('PICKLISTS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  END show_picklists_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old PICKLISTS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  PROCEDURE purge_picklists(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_picklists(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      SELECT rowid FROM picklists WHERE creation_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_picklists_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- Loop through PICKLISTS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- (1) Save most recent 15 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_picklists IN c_picklists(get_min_saved_date('PICKLISTS',                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                                         p_days_saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                        
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM picklists WHERE rowid = crec_picklists.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('PICKLISTS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_picklists');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      display_purge_message('PICKLISTS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  END purge_picklists;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  -- Get count of PICK_WAVES that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  PROCEDURE show_pick_waves_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('PICK_WAVES', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- Get count of PICK_WAVES to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM pick_waves                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
     WHERE creation_date < v_min_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
       AND pick_wave_id NOT IN (SELECT pick_wave_id FROM picklists);                                                                                                                                                                                                                                                                                                                                                                                                                                                
    display_count_message('PICK_WAVES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  END show_pick_waves_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old PICK_WAVES.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE purge_pick_waves(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_pick_waves(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM pick_waves                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
       WHERE creation_date < cp_min_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
         AND pick_wave_id NOT IN (SELECT pick_wave_id FROM picklists);                                                                                                                                                                                                                                                                                                                                                                                                                                              
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_pick_waves_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    -- Loop through PICK_WAVES to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    -- (1) Save most recent 15 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_pick_waves IN c_pick_waves(get_min_saved_date('PICK_WAVES',                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                           p_days_saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                      
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM pick_waves WHERE rowid = crec_pick_waves.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('PICK_WAVES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_pick_waves');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      display_purge_message('PICK_WAVES', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  END purge_pick_waves;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
/*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  -- Get count of PROBLEM_SHIPMENTS to be purged.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  PROCEDURE show_problem_shipment_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                           
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('PROBLEM_SHIPMENTS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                            
    -- Get count of PROBLEM_SHIPMENTS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM (SELECT shipment_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
              FROM problem_shipments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
             WHERE creation_date < v_min_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
            MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
            SELECT shipment_id FROM pending_customer_shipments);                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    display_count_message('PROBLEM_SHIPMENTS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  END show_problem_shipment_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  -- Delete PROBLEM_SHIPMENTS and its related PROBLEM_SHIPMENT_ITEMS                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -- that are not associated w/ a PENDING_CUSTOMER_SHIPMENT.                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  PROCEDURE purge_problem_shipments(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                               
    v_item_count     INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    v_shipment_count INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    -- Get PROBLEM_SHIPMENTS that are more than 30 days old and                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    -- not associated w/ a PENDING_CUSTOMER_SHIPMENT                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_problem_shipments(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      SELECT shipment_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        FROM problem_shipments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
       WHERE creation_date < cp_min_date                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      MINUS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      SELECT shipment_id FROM pending_customer_shipments;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    -- Cursor to get PROBLEM_SHIPMENT_ITEMS for a SHIPMENT_ID                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    CURSOR c_problem_shipment_items(cp_shipment_id NUMBER) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM problem_shipment_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       WHERE shipment_id = cp_shipment_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_problem_shipment_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    -- Loop through the old PROBLEM_SHIPMENTS and purge its                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- PROBLEM_SHIPMENT_ITEMS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    FOR crec_shipment IN c_problem_shipments(get_min_saved_date('PROBLEM_SHIPMEN                                                                                                                                                                                                                                                                                                                                                                                                                                    
TS',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                p_days_saved)) L                                                                                                                                                                                                                                                                                                                                                                                                                                    
OOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      -- Delete the PROBLEM_SHIPMENT_ITEMS for a PROBLEM_SHIPMENT.                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FOR crec_item IN c_problem_shipment_items(crec_shipment.shipment_id) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                     
        DELETE FROM problem_shipment_items WHERE rowid = crec_item.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                           
        -- Incrementally commit.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
        v_item_count := incremental_commit(v_item_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Delete the PROBLEM_SHIPMENTS row                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      DELETE FROM problem_shipments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       WHERE shipment_id = crec_shipment.shipment_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      -- Commit the change.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
      v_shipment_count := v_shipment_count + 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    display_purge_message('PROBLEM_SHIPMENTS', v_shipment_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    display_purge_message('PROBLEM_SHIPMENT_ITEMS', v_item_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_problem_shipments');                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      display_purge_message('PROBLEM_SHIPMENTS', v_shipment_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      display_purge_message('PROBLEM_SHIPMENT_ITEMS', v_item_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  END purge_problem_shipments;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of RECEIVE_PROBLEM_ITEMS_HISTORY to be purged.                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  PROCEDURE show_rec_prob_item_hist_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                         
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('RECEIVE_PROBLEM_ITEMS_HISTORY',                                                                                                                                                                                                                                                                                                                                                                                                                                               
                                     p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Get count of RECEIVE_PROBLEM_ITEMS_HISTORY to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM receive_problem_items_history                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
     WHERE last_updated_date < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    display_count_message('RECEIVE_PROBLEM_ITEMS_HISTORY', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  END show_rec_prob_item_hist_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old RECEIVE_PROBLEM_ITEMS_HISTORY records                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  PROCEDURE purge_rec_prob_item_hist(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                              
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_receive_problem_items_hist(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM receive_problem_items_history                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
       WHERE last_updated_date < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_rec_prob_item_hist_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    -- Loop through RECEIVE_PROBLEM_ITEMS_HISTORY to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    -- (1) Save most recent 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_rec_item IN c_receive_problem_items_hist(get_min_saved_date('RECEIV                                                                                                                                                                                                                                                                                                                                                                                                                                    
E_PROBLEM_ITEMS_HISTORY',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                         p_days_                                                                                                                                                                                                                                                                                                                                                                                                                                    
saved)) LOOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM receive_problem_items_history                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       WHERE rowid = crec_rec_item.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('RECEIVE_PROBLEM_ITEMS_HISTORY', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_rec_prob_item_hist');                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
      display_purge_message('RECEIVE_PROBLEM_ITEMS_HISTORY', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                              
  END purge_rec_prob_item_hist;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of RECEIVE_SESSION_SCANS that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                          
  PROCEDURE show_rec_session_scan_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                           
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('RECEIVE_SESSION_SCANS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                        
    -- Get count of RECEIVE_SESSION_SCANS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM receive_session_scans                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
     WHERE receive_time < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    display_count_message('RECEIVE_SESSION_SCANS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  END show_rec_session_scan_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old RECEIVE_SESSIOIN_SCANS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  PROCEDURE purge_receive_session_scans(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                           
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_receive_session_scans(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      SELECT rowid                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
        FROM receive_session_scans                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
       WHERE receive_time < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_rec_session_scan_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    -- Loop through RECEIVE_SESSION_SCANS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- (1) Save most recent 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_scan IN c_receive_session_scans(get_min_saved_date('RECEIVE_SESSION                                                                                                                                                                                                                                                                                                                                                                                                                                    
_SCANS',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                p_days_saved)) L                                                                                                                                                                                                                                                                                                                                                                                                                                    
OOP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM receive_session_scans WHERE rowid = crec_scan.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                              
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('RECEIVE_SESSION_SCANS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_receive_session_scans');                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      display_purge_message('RECEIVE_SESSION_SCANS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  END purge_receive_session_scans;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of RECEIVE_SESSIONS that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  PROCEDURE show_receive_sessions_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                           
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('RECEIVE_SESSIONS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- Get count of RECEIVE_SESSIONS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM receive_sessions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
     WHERE start_time < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    display_count_message('RECEIVE_SESSIONS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  END show_receive_sessions_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old RECEIVE_SESSIONS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  PROCEDURE purge_receive_sessions(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                
    v_count INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    CURSOR c_receive_sessions(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      SELECT rowid FROM receive_sessions WHERE start_time < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                            
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    show_receive_sessions_count(p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    -- Loop through RECEIVE_SESSIONS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    -- (1) Save most recent 30 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_rec_sess IN c_receive_sessions(get_min_saved_date('RECEIVE_SESSIONS                                                                                                                                                                                                                                                                                                                                                                                                                                    
',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                               p_days_saved)) LO                                                                                                                                                                                                                                                                                                                                                                                                                                    
OP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      -- Delete the record.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
      DELETE FROM receive_sessions WHERE rowid = crec_rec_sess.rowid;                                                                                                                                                                                                                                                                                                                                                                                                                                               
      -- Increment the counter and commit at the interval.                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      v_count := incremental_commit(v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('RECEIVE_SESSIONS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_receive_sessions');                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
      display_purge_message('RECEIVE_SESSIONS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  END purge_receive_sessions;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  ----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
  -- Get count of WHSE_DEMANDS that can be purged                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
  PROCEDURE show_whse_demands_count(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                               
    v_count    INTEGER;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    v_min_date := get_min_saved_date('WHSE_DEMANDS', p_days_saved);                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    -- Get count of WHSE_DEMANDS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    SELECT COUNT(*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      INTO v_count                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      FROM whse_demands                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
     WHERE last_updated < v_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    display_count_message('WHSE_DEMANDS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  END show_whse_demands_count;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  -----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  -- Purge old WHSE_DEMANDS that is more than 60 days old, then purge                                                                                                                                                                                                                                                                                                                                                                                                                                               
  -- corresponding records in WHSE_DEMAND_ITEMS, PICK_DEMANDS,                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  -- CHUTE_DEMANDS, WHSE_DEMAND_PROCESS_CAT_MAP, and WHSE_DEMAND_EVENTS.                                                                                                                                                                                                                                                                                                                                                                                                                                            
  PROCEDURE purge_whse_demands(p_days_saved NUMBER DEFAULT 0) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    v_count INTEGER := 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    const_wd_commit_interval     CONSTANT INTEGER := 1500;                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    const_wd_sleep_interval_secs CONSTANT INTEGER := 20;                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    CURSOR c_whse_demands(cp_min_date DATE) IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
      SELECT whse_demand_id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
        FROM whse_demands                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
       WHERE last_updated < cp_min_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- Loop through WHSE_DEMANDS to purge.                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    -- (1) Save most recent 60 days of data.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    FOR crec_whse_demands IN c_whse_demands(get_min_saved_date('WHSE_DEMANDS',                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                               p_days_saved)) LO                                                                                                                                                                                                                                                                                                                                                                                                                                    
OP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      -- Delete from WHSE_DEMAND_ITEMS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      DELETE FROM whse_demand_items                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
       WHERE whse_demand_id = crec_whse_demands.whse_demand_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Delete from PICK_DEMANDS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
      DELETE FROM pick_demands                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
       WHERE whse_demand_id = crec_whse_demands.whse_demand_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Delete from CHUTE_DEMANDS.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      DELETE FROM chute_demands                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
       WHERE whse_demand_id = crec_whse_demands.whse_demand_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Delete from WHSE_DEMAND_PROCESS_CAT_MAP.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      DELETE FROM whse_demand_process_cat_map                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
       WHERE whse_demand_id = crec_whse_demands.whse_demand_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Delete from WHSE_DEMAND_EVENTS                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
      DELETE FROM whse_demand_events                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
       WHERE whse_demand_id = crec_whse_demands.whse_demand_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Delete from WHSE_DEMANDS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      DELETE FROM whse_demands                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
       WHERE whse_demand_id = crec_whse_demands.whse_demand_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      -- Increment the counter.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
      v_count := NVL(v_count, 0) + 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
      -- Since there are multiple records per WHSE_DEMANDS record, we will commi                                                                                                                                                                                                                                                                                                                                                                                                                                    
t                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
      -- more often                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
      IF MOD(v_count, const_wd_commit_interval) = 0 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                            
        COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
        DBMS_LOCK.SLEEP(const_wd_sleep_interval_secs);                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    END LOOP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    -- Commit remaining records and display message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    COMMIT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    display_purge_message('WHSE_DEMANDS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('purge_whse_demands');                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
      display_purge_message('WHSE_DEMANDS', v_count);                                                                                                                                                                                                                                                                                                                                                                                                                                                               
  END purge_whse_demands;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
  -- Jobs to run daily.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
  PROCEDURE run_daily IS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    v_dbname v$database.name%TYPE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    cursor dbname_cur is                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
      select name from v$database;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
  BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    open dbname_cur;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    fetch dbname_cur                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      into v_dbname;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    close dbname_cur;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    purge_license_plate;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    purge_containers;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
    purge_distributor_orders;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    purge_picked_shipments;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    purge_problem_shipments;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    purge_rec_prob_item_hist;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    purge_receive_session_scans;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    purge_pick_waves;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    purge_picklists;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    purge_cash_sorter_chutes_hist;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    purge_pbs_rollover_hist;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    purge_receive_sessions;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    purge_pick_ship_batch_hist;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
/* deprecate unused tables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    purge_fc_asin_sales;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
*/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    purge_induction_session_scans;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    purge_induction_sessions;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    purge_whse_demands;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    -- Mark PICKED_BATCH_CONTAINERS (PBC) that are empty.                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    pbc_mark_empty;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
  EXCEPTION                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    WHEN OTHERS THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
      log_error('run_daily');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
  END run_daily;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  --                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
--                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
END dc_cleanup;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    

DCBFI1>spool off
